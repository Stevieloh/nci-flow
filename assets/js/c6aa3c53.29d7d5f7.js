"use strict";(self.webpackChunknci_flow=self.webpackChunknci_flow||[]).push([[9324],{3905:(e,t,r)=>{r.d(t,{Zo:()=>s,kt:()=>m});var a=r(7294);function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function o(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){n(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function l(e,t){if(null==e)return{};var r,a,n=function(e,t){if(null==e)return{};var r,a,n={},i=Object.keys(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}var p=a.createContext({}),c=function(e){var t=a.useContext(p),r=t;return e&&(r="function"==typeof e?e(t):o(o({},t),e)),r},s=function(e){var t=c(e.components);return a.createElement(p.Provider,{value:t},e.children)},u="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},f=a.forwardRef((function(e,t){var r=e.components,n=e.mdxType,i=e.originalType,p=e.parentName,s=l(e,["components","mdxType","originalType","parentName"]),u=c(r),f=n,m=u["".concat(p,".").concat(f)]||u[f]||d[f]||i;return r?a.createElement(m,o(o({ref:t},s),{},{components:r})):a.createElement(m,o({ref:t},s))}));function m(e,t){var r=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var i=r.length,o=new Array(i);o[0]=f;var l={};for(var p in t)hasOwnProperty.call(t,p)&&(l[p]=t[p]);l.originalType=e,l[u]="string"==typeof e?e:n,o[1]=l;for(var c=2;c<i;c++)o[c]=r[c];return a.createElement.apply(null,o)}return a.createElement.apply(null,r)}f.displayName="MDXCreateElement"},5162:(e,t,r)=>{r(7294)},3502:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>p,contentTitle:()=>o,default:()=>d,frontMatter:()=>i,metadata:()=>l,toc:()=>c});var a=r(7462),n=(r(7294),r(3905));r(5162);const i={sidebar_position:4,title:"Step 3 - Creating the policies and policy redirect to the Fortigate Firewall"},o=void 0,l={unversionedId:"VPC-L7 Integration/lab-3-configure-pbr-fw",id:"VPC-L7 Integration/lab-3-configure-pbr-fw",title:"Step 3 - Creating the policies and policy redirect to the Fortigate Firewall",description:"Create Policy Based Redirect (PBR) in VPC",source:"@site/docs/VPC-L7 Integration/lab-3-configure-pbr-fw.md",sourceDirName:"VPC-L7 Integration",slug:"/VPC-L7 Integration/lab-3-configure-pbr-fw",permalink:"/nci-flow/docs/VPC-L7 Integration/lab-3-configure-pbr-fw",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/VPC-L7 Integration/lab-3-configure-pbr-fw.md",tags:[],version:"current",sidebarPosition:4,frontMatter:{sidebar_position:4,title:"Step 3 - Creating the policies and policy redirect to the Fortigate Firewall"},sidebar:"tutorialSidebar",previous:{title:"Step 2 - Configuring the Fortigate Firewall ",permalink:"/nci-flow/docs/VPC-L7 Integration/lab-2-configure-pa-fw"},next:{title:"3.0 VLAN Based Microsegmentation",permalink:"/nci-flow/docs/category/30-vlan-based-microsegmentation"}},p={},c=[],s={toc:c},u="wrapper";function d(e){let{components:t,...i}=e;return(0,n.kt)(u,(0,a.Z)({},s,i,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"Create Policy Based Redirect (PBR) in VPC")),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Login to the Prism Central ")),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Click on Infrastructure in the App Switcher")),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Scroll down on the side bar to go to Network and Security")),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Click on Virtual Private Clouds")),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Click on the VPC that was created")),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Click on the Policies Tab, by default there is already a policy rule with any-any created at priority 10. Higher priorities rules will be matched first. Thus we will need to create a rule that has a higher number in priority compared to the default one. ")),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Click on Create Policies"),(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"Priority :      30 "),(0,n.kt)("li",{parentName:"ul"},"Source :        Custom  (Specify the source ip address as 10.1.1.0/24. This is the network address for the web subnet)"),(0,n.kt)("li",{parentName:"ul"},"Destination:    Custom  (Specify the destination ip address as 20.1.1.0/24. This is the network address for the app subnet)"),(0,n.kt)("li",{parentName:"ul"},"Protocol:       Any"),(0,n.kt)("li",{parentName:"ul"},"Actions:        ReRoute",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"Reroute IP:   IP Address of the Fortigate Firewall Production NIC "))),(0,n.kt)("li",{parentName:"ul"},'Click on the checkbox "Additional Create Policy in reverse direction"'))),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Click on the Create button"))),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"Verify that the PBR rule is indeed forwarding traffic to the Virtual Firewall")),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"From the Prism central, launch the web console to the Web Virtual Machine, login with the credentials and perform a continous ping to the App VM. Verify that the ping is successful")),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},'SSH to the Fortigate Firewall , ssh admin@<"Fortigate Floating IP address">')),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Once logged in, run the following command to display the packet capture and to confirm the packets are going through the firewall"),(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"diagnose packet sniffer port1 none ")),(0,n.kt)("p",{parentName:"li"},"A sample output as per below"),(0,n.kt)("p",{parentName:"li"},(0,n.kt)("img",{src:r(1772).Z,width:"1860",height:"1146"})))),(0,n.kt)("p",null,"This confirms that the Nutanix VPC is indeed sending traffic to the Palo Alto VM. In a real world scenario, additional rules will be applied to inspect the traffic received by the firewall. This also showcases the use of Policy Based Routing on the Nutanix VPC integration with the Palo Alto."))}d.isMDXComponent=!0},1772:(e,t,r)=>{r.d(t,{Z:()=>a});const a=r.p+"assets/images/fg_packet_capture-0a367887838ede1c654a2158b27ac2e9.png"}}]);